<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="The iPerf3 tool serves as a quick check to ensure that the network link is up and running close to expectations. As a simple passthrough device, we expect the Supermicro SuperServer E302-9D to achieve line-rates for 10G traffic across various interfaces. We do expect the rates to go down as more processing is added in"><meta name=generator content="Hugo 0.98.0"><meta name=robots content="index,follow,noarchive"><title>Benchmarking with iPerf3 and ipgen &#183;</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/blackburn.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet type=text/css><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=./img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=./index.html>BlogPaper</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=./index.html><i class="fa fa-home fa-fw"></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=./post/index.html><i class="fa fa-list fa-fw"></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=./sitemap.xml><i class="fa fa-user fa-fw"></i>Sitemap</a></li><li class=pure-menu-item><a class=pure-menu-link href=./index.xml><i class="fa fa-phone fa-fw"></i>RSS</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small>&copy; 2022. All rights reserved.</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div></div><div id=main><div class=header><h1>Benchmarking with iPerf3 and ipgen</h1><h2>The iPerf3 tool serves as a quick check to ensure that the network link is up and running close to expectations. As a simple passthrough device, we expect the Supermicro SuperServer E302-9D to achieve line-rates for 10G traffic across various interfaces. We do expect the rates to go down as more processing is added in</h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>11 Jul 2024, 00:00</time></div></div><p>The <i>iPerf3</i> tool serves as a quick check to ensure that the network link is up and running close to expectations. As a simple passthrough device, we expect the Supermicro SuperServer E302-9D to achieve line-rates for 10G traffic across various interfaces. We do expect the rates to go down as more processing is added in the form of firewalling and NAT. Towards this, each tested mode is started off with an <i>iPerf3</i> test. Following that, we perform the sweep of various packet sizes with the <i>pkt-gen</i> tool. In both cases, each 10G interface set is tested separately, followed by both sets simultaneously. After both sets of experiments, the L3 forwarding test using <i>ipgen</i> is performed from each of the three machines in the test setup. This section discusses only the <i>iPerf3</i> and <i>ipgen</i> results. The former includes IPsec evaluation also.</p><h3><i>iPerf3</i></h3><p>Commands are executed on the source, sink, and DUT using the <i>Conductor</i> python package described in the testing methodology section. The setup steps on the DUT for each mode were described in the previous section. Only the source and sink [Run] phases are described here.</p><p align=center><a href=#><img alt src=https://cdn.statically.io/img/images.anandtech.com/doci/15906/0724-test-setup_575px.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></a></p><p>On the sink side, two servers are spawned out and terminated after 3 minutes. The <i>spawn</i> and <i>timeout</i> refer to keywords specified by the <i>Conductor</i> package.<br><code>spawn0: cpuset -l 1,2 iperf3 -s -B 172.16.10.2 -p 5201<br>spawn1: cpuset -l 3,4 iperf3 -s -B 172.16.11.2 -p 5201<br>timeout180: sleep 180<br>step3: killall iperf3</code></p><p>On the source side, the first link is evaluated for 30s, followed by the second link. In the third iteration, the tests are spawned off for both links simultaneously.<br><code>spawn1: cpuset -l 1,2 iperf3 -c 172.16.10.2 -B 172.16.0.2 -P 4 -O 5 -t 35 --logfile /tmp/.1c.0.txt<br>timeout45: sleep 45<br>spawn3: cpuset -l 1,2 iperf3 -c 172.16.11.2 -B 172.16.1.2 -P 4 -O 5 -t 35 --logfile /tmp/.1c.1.txt<br>timeout46: sleep 45<br>spawn5: cpuset -l 1,2 iperf3 -c 172.16.10.2 -B 172.16.0.2 -P 4 -O 5 -t 35 --logfile /tmp/.2c.0.txt<br>spawn6: cpuset -l 3,4 iperf3 -c 172.16.11.2 -B 172.16.1.2 -P 4 -O 5 -t 35 --logfile /tmp/.2c.1.txt</code></p><p>The table below presents the bandwidth numbers obtained in various modes. The interfaces specified in the headers refer to the ones in the DUT.</p><table align=center border=1 cellpadding=0 cellspacing=0 width=100%><tbody readability=1><tr class=tgrey readability=2><td align=center colspan=5>Supermicro E302-9D as pfSense Firewall - <i>iPerf3</i> Benchmark (Gbps)</td></tr><tr class=tlblue><td align=center width=30%>Mode</td><td align=center colspan=2>Single Stream</td><td align=center colspan=2>Dual Stream</td></tr><tr class=tlblue><td align=center width=20%>&nbsp;</td><td align=center>ixl2 - ixl0</td><td align=center>ixl3 - ixl1</td><td align=center>ixl2 - ixl0</td><td align=center>ixl3 - ixl1</td></tr><tr><td class=tlgrey rowspan=1>Router</td><td align=center>9.40</td><td align=center>9.41</td><td align=center>8.77</td><td align=center>8.67</td></tr><tr><td class=tlgrey rowspan=1>PF (No Filters)</td><td align=center>6.99</td><td align=center>6.96</td><td align=center>6.50</td><td align=center>6.98</td></tr><tr><td class=tlgrey rowspan=1>PF (Default Ruleset)</td><td align=center>5.43</td><td align=center>5.81</td><td align=center>4.22</td><td align=center>5.69</td></tr><tr><td class=tlgrey rowspan=1>PF (NAT Mode)</td><td align=center>7.89</td><td align=center>6.99</td><td align=center>4.49</td><td align=center>6.06</td></tr></tbody></table><p>Line-rates are obtained for the plain router mode. Enabling the packet filtering lowers the performance, as expected - with more rules resulting in slightly lower performance. The NAT mode doesn't exhibit much performance loss compared to the plain PF mode, but, multiple streams on different interfaces needing NAT at the same time does bring the performance more compared to the <i>PF (No Filters)</i> mode.</p><h3>IPsec Testing using <i>iPerf3</i></h3><p>IPsec testing also involves a similar set of scripts, except that only the ixl2 and ixl3 interfaces of the DUT are involved. The table below presents the <i>iPerf3</i> bandwidth numbers for various tested combinations of encryption and authentication algorithms. The running of the <i>iPerf3</i> server on the DUT itself may result in lower than actual performance - however, the comparison against the baseline case under similar conditions can still be made.</p><table align=center border=1 cellpadding=0 cellspacing=0 width=100%><tbody readability=1><tr class=tgrey readability=2><td align=center colspan=5>Supermicro E302-9D as pfSense Firewall - IPsec <i>iPerf3</i> Benchmark (Mbps)</td></tr><tr class=tlblue><td align=center width=30%>Algorithm</td><td align=center colspan=2>Single Stream</td><td align=center colspan=2>Dual Stream</td></tr><tr class=tlblue><td align=center width=20%>&nbsp;</td><td align=center>(Src)ixl2 - (DUT)ixl2</td><td align=center>(Src)ixl3 - (DUT)ixl3</td><td align=center>(Src)ixl2 - (DUT)ixl2</td><td align=center>(Src)ixl3 - (DUT)ixl3</td></tr><tr><td class=tlgrey rowspan=1>Baseline (No IPsec)</td><td align=center>5140</td><td align=center>7450</td><td align=center>3020</td><td align=center>4880</td></tr><tr><td class=tlgrey rowspan=1>3des-hmac-md5</td><td align=center>119</td><td align=center>118</td><td align=center>61.3</td><td align=center>75.2</td></tr><tr><td class=tlgrey rowspan=1>aes-cbc-sha</td><td align=center>374</td><td align=center>373</td><td align=center>236</td><td align=center>238</td></tr><tr><td class=tlgrey rowspan=1>aes-hmac-sha2-256</td><td align=center>377</td><td align=center>376</td><td align=center>235</td><td align=center>212</td></tr><tr><td class=tlgrey rowspan=1>aes-hmac-sha2-512</td><td align=center>433</td><td align=center>430</td><td align=center>259</td><td align=center>280</td></tr></tbody></table><p>The above numbers are low compared to the line-rate, but closely match the results uploaded to the repository specified in the the AsiaBSDCon 2015 <a href=#>network performance evaluation paper</a> for a much more powerful system. Given the 60W TDP nature of the SoC and the passively cooled configuration, coupled with the absence of QuickAssist in the SKU, the numbers are passable. It must also be noted that this is essentially an out-of-the-box benchmark number, and optimizations could extract more performance out of the system (an interesting endeavour for the homelab enthusiast).</p><h3>L3 Forwarding Test with <i>ipgen</i></h3><p>The <i>ipgen</i> L3 forwarding test is executed on a single machine with two of its interfaces connected to the DUT. In the evaluation testbed, this condition is satisfied by the source, sink, and the conductor as well. The <i>ipgen</i> tool supports scripting of a sweep of packet and transmission bandwidth combinations. The script is provided to the tool using a command of the following form:<br><code>ipgen -T ${TxIntf},${TxGatewayIP},${TxSubnet} -R ${RxIntf},${RxGatewayIP},${RxSubnet} -S $ScriptToRun -L $LogFN</code><br>where the arguments refer to the transmitter interface, the IP of the gateway to which the interface connects, and its subnet specifications, along with a similar set for the receiver interface.</p><p align=center><img id=imagesrcipgen src=https://cdn.statically.io/img/images.anandtech.com/doci/15906/wm-l3fwd-intel-xd2123it-router-mode.png width=100% style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></p><p align=center><img id=imagesnkipgen src=https://cdn.statically.io/img/images.anandtech.com/doci/15906/wm-l3fwd-intel-xd1540-router-mode.png width=100% style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></p><p align=center>&nbsp;</p><p align=center><img id=imagecdripgen src=https://cdn.statically.io/img/images.anandtech.com/doci/15906/wm-l3fwd-amd-a10m-router-mode.png width=100% style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></p><p>Twelve distinct runs were processed, once in each of the four tested modes for each of the machines connected to the DUT. As mentioned earlier, these numbers are likely limited by the capabilities of the source (like in the case of the Compulab fitlet-XA10-LAN), but the other two machines present some interesting results that corraborate with results observed in the <i>iPerf3</i> and <i>pkt-gen</i> benchmarks. In general, increasing the number of rules seems to noticeably affect the performance. Enabling NAT, on the other hand, doesn't have such a discernible impact compared to other configurations with similar number of rules to process.</p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmivp6x7orrAp5utnZOde6S7zGiqoaenZH52hY9vZqytoJq%2FrrXCq6Zmq6WlsrO%2FxKutnqpdmoBxfpidZKudpp6yuHnAZp2appyawLR5kGmeZqiWqLKvv8Rmp6ivlae1sMHSnmZw</p><h4><i class="fas fa-share-alt" aria-hidden=true></i>&nbsp;Share!</h4><ul class=share-buttons><li><a href="https://www.facebook.com/sharer/sharer.php?u=%2fsupermicro-superserver-e3029d-review-a-fanless-10g-pfsense-powerhouse.html" target=_blank title="Share on Facebook"><i class="fab fa-facebook" aria-hidden=true></i><span class=sr-only>Share on Facebook</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://twitter.com/intent/tweet?source=%2fsupermicro-superserver-e3029d-review-a-fanless-10g-pfsense-powerhouse.html" target=_blank title=Tweet><i class="fab fa-twitter" aria-hidden=true></i><span class=sr-only>Tweet</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://plus.google.com/share?url=%2fsupermicro-superserver-e3029d-review-a-fanless-10g-pfsense-powerhouse.html" target=_blank title="Share on Google+"><i class="fab fa-google-plus" aria-hidden=true></i><span class=sr-only>Share on Google+</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.tumblr.com/share?v=3&u=%2fsupermicro-superserver-e3029d-review-a-fanless-10g-pfsense-powerhouse.html" target=_blank title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden=true></i><span class=sr-only>Post to Tumblr</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://pinterest.com/pin/create/button/?url=%2fsupermicro-superserver-e3029d-review-a-fanless-10g-pfsense-powerhouse.html" target=_blank title="Pin it"><i class="fab fa-pinterest-p" aria-hidden=true></i><span class=sr-only>Pin it</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.reddit.com/submit?url=%2fsupermicro-superserver-e3029d-review-a-fanless-10g-pfsense-powerhouse.html" target=_blank title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden=true></i><span class=sr-only>Submit to Reddit</span></a></li></ul><style>ul.share-buttons{list-style:none;padding:0}ul.share-buttons li{display:inline}ul.share-buttons .sr-only{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}</style><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=./best-of-idaho-boise-crabshack-worker-brings-couple-usual-friday-lunch-date-order.html><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=./best-of-idaho-boise-crabshack-worker-brings-couple-usual-friday-lunch-date-order.html>Best of Idaho: Boise Joe's Crab Shack worker brings couple usual Friday lunch date order</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=./are-shay-butler-and-colette-still-married.html>Are Shay Butler and Colette still married?</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=./are-shay-butler-and-colette-still-married.html><i class="fa fa-chevron-right"></i></a></div></div></div></div></div><script src=https://assets.cdnweb.info/hugo/blackburn/js/ui.js></script>
<script src=https://assets.cdnweb.info/hugo/blackburn/js/menus.js></script>
<script src=./js/math-code.js></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>